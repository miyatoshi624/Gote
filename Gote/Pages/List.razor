@page "/list/{CategoryId:int}"

@inject NavigationManager Navigation
@inject ISupabaseService SupabaseService

@if (_memos is null)
{
    <div>読み込み中...</div>
}
else if (!_memos.Any())
{
    <div>メモがありません</div>
}
else
{
    <ul class="list-group">
        @foreach (var memo in _memos)
        {
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <span class="pointer" @onclick="() => Edit(memo.Id)"><strong>@memo.Title</strong></span>
                    <div class="text-muted small">@memo.UpdatedAt.ToString("yyyy/MM/dd HH:mm")</div>
                </div>
                <button class="btn btn-danger btn-sm" @onclick="() => Delete(memo.Id)">削除</button>
            </li>
        }
    </ul>
}

@code {
    /// <summary>
    /// カテゴリID
    /// </summary>
    [Parameter]
    public int CategoryId { get; set; }
    /// <summary>
    /// メモ一覧
    /// </summary>
    private List<Memo>? _memos;

    /// <summary>
    /// パラメータ設定時処理
    /// </summary>
    /// <returns></returns>
    protected override async Task OnParametersSetAsync()
    {
        _memos = await SupabaseService.GetMemosAsync(CategoryId);
    }

    /// <summary>
    /// メモ作成画面へ遷移
    /// </summary>
    private void Create()
    {
        Navigation.NavigateTo($"/edit/{CategoryId}");
    }

    /// <summary>
    /// メモ編集画面へ遷移
    /// </summary>
    /// <param name="memoId"></param>
    private void Edit(int memoId)
    {
        Navigation.NavigateTo($"/edit/{CategoryId}/{memoId}");
    }

    /// <summary>
    /// メモ削除
    /// </summary>
    /// <param name="memoId"></param>
    /// <returns></returns>
    private async Task Delete(int memoId)
    {
        await SupabaseService.DeleteMemoAsync(memoId);
    }
}
